From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Tue, 1 May 2018 20:18:54 -0400
Subject: [PATCH] EndermanAttackPlayerEvent

Allow control over whether or not an enderman aggros a player.

This allows you to override/extend the pumpkin/stare logic.

diff --git a/src/main/java/net/minecraft/world/entity/monster/EnderMan.java b/src/main/java/net/minecraft/world/entity/monster/EnderMan.java
index 2c332e21500b2ee709867ec1a7b1f6a107c7ca93..0adc178d34d06bb952f50937ad8cf21adbd95001 100644
--- a/src/main/java/net/minecraft/world/entity/monster/EnderMan.java
+++ b/src/main/java/net/minecraft/world/entity/monster/EnderMan.java
@@ -220,7 +220,15 @@ public class EnderMan extends Monster implements NeutralMob {
         this.readPersistentAngerSaveData(this.level, nbt);
     }
 
-    boolean isLookingAtMe(Player player) {
+    // Paper start - EndermanAttackPlayerEvent
+    private boolean isLookingAtMe(Player player) {
+        boolean shouldAttack = isLookingAtMe_check(player);
+        io.papermc.paper.event.entity.EndermanAttackPlayerEvent event = new io.papermc.paper.event.entity.EndermanAttackPlayerEvent((org.bukkit.entity.Enderman) getBukkitEntity(), (org.bukkit.entity.Player) player.getBukkitEntity());
+        event.setCancelled(!shouldAttack);
+        return event.callEvent();
+    }
+    private boolean isLookingAtMe_check(Player player) {
+        // Paper end
         ItemStack itemstack = (ItemStack) player.getInventory().armor.get(3);
 
         if (itemstack.is(Blocks.CARVED_PUMPKIN.asItem())) {
